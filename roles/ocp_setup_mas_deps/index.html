<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://ibm-mas.github.io/ansible-devops/roles/ocp_setup_mas_deps/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>ocp_setup_mas_deps - MAS Devops Collection</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "ocp_setup_mas_deps";
    var mkdocs_page_input_path = "roles/ocp_setup_mas_deps.md";
    var mkdocs_page_url = "/ansible-devops/roles/ocp_setup_mas_deps/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MAS Devops Collection</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Full Stack Playbooks</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/fullstack-roks/">IBM Cloud</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Lite Playbooks</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/lite-core-roks/">Core only on IBM Cloud</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/lite-core-quickburn/">Core only on QuickBurn</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/lite-manage-roks/">Manage on IBM Cloud</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Other Playbooks</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/ocp/">OCP Playbooks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/dependencies/">Dependencies Playbooks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/cp4d/">CP4D Playbooks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../playbooks/mas/">MAS Playbooks</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Roles</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../amqstreams/">amqstreams</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ansible_version_check/">ansible_version_check</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../appconnect_install/">appconnect_install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cos_setup/">cos_setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cp4d_db2wh/">cp4d_db2wh</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cp4d_db2wh_backup/">cp4d_db2wh_backup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cp4d_db2wh_manage_hack/">cp4d_db2wh_manage_hack</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cp4d_db2wh_restore/">cp4d_db2wh_restore</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cp4d_hack_worker_nodes/">cp4d_hack_worker_nodes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cp4d_install/">cp4d_install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cp4d_install_services/">cp4d_install_services</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../db2u/">db2u</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../gencfg_sls/">gencfg_sls</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../gencfg_workspace/">gencfg_workspace</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../install_operator/">install_operator</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mongodb/">mongodb</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ocp_deprovision/">ocp_deprovision</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ocp_login/">ocp_login</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ocp_provision/">ocp_provision</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ocp_setup_github_oauth/">ocp_setup_github_oauth</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">ocp_setup_mas_deps</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#role-variables">Role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#artifactory_username">artifactory_username</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#artifactory_apikey">artifactory_apikey</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_retention_period">prometheus_retention_period</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_storage_class">prometheus_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_storage_size">prometheus_storage_size</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_alertmgr_storage_class">prometheus_alertmgr_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_alertmgr_storage_size">prometheus_alertmgr_storage_size</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_userworkload_retention_period">prometheus_userworkload_retention_period</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_userworkload_storage_class">prometheus_userworkload_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_userworkload_storage_size">prometheus_userworkload_storage_size</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mas_channel">mas_channel</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#license">License</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ocp_setup_ocs/">ocp_setup_ocs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ocp_verify/">ocp_verify</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../sls_install/">sls_install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../suite_app_configure/">suite_app_configure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../suite_app_install/">suite_app_install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../suite_config/">suite_config</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../suite_dns/">suite_dns</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../suite_install/">suite_install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../suite_mustgather/">suite_mustgather</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../suite_verify/">suite_verify</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../uds_install/">uds_install</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MAS Devops Collection</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Roles &raquo;</li>
        
      
    
    <li>ocp_setup_mas_deps</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ibm-mas/ansible-devops/blob/master/docs/roles/ocp_setup_mas_deps.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="ocp_setup_mas_deps">ocp_setup_mas_deps<a class="headerlink" href="#ocp_setup_mas_deps" title="Permanent link"></a></h1>
<p>This role provides support to install operators that are required by MAS to work. The role will deploy Service Binding Operator in all namespaces and Cert Manager in the cert-manager namespace.  The role declares a dependency on <code>ocp_verify</code> to ensure that the RedHat Operator Catalog is installed and ready before we try to install the Service Binding Operator from that catalog.
In addition, this role updates cluster's internal image registry settings to increase storage to 400GB (needed only for ROKS Cluster to install full stack of services in CP4D) and to configure custom storage for the Prometheus monitoring service for both the k8s and User Workload (in namespace <code>openshift-user-workload-monitoring</code>) Prometheus instances.</p>
<p>For MAS 8.6 or earlier JetStack cert-manager v1.2 is installed into the <code>cert-manager</code> namespace.  When used for MAS 8.7+ this role will result in the following operators being installed in the ibm-common-services namespace:
- IBM Cert Manager
- IBM Cloud Pak Foundational Services
- IBM NamespaceScope Operator
- Operand Deployment Lifecycle Manager</p>
<p>For MAS 8.6 or earlier (or when running MAS 8.7 on OCP 4.6) Service Binding Operator v0.8 will be installed from the preview channel.  It is important not to upgrade to later preview builds as they are incompatible with MAS due to breaking API changes in SBO.  For MAS 8.7 or later the stable channel will be used instead, with automatic updates enabled.  In both cases, the operator will be installed in the <code>openshift-operators</code> namespace with cluster scope.</p>
<h2 id="role-variables">Role Variables<a class="headerlink" href="#role-variables" title="Permanent link"></a></h2>
<h3 id="artifactory_username">artifactory_username<a class="headerlink" href="#artifactory_username" title="Permanent link"></a></h3>
<p>Use to enable the install of development catalog sources for pre-release installation.</p>
<ul>
<li>Environment Variable: <code>W3_USERNAME</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="artifactory_apikey">artifactory_apikey<a class="headerlink" href="#artifactory_apikey" title="Permanent link"></a></h3>
<p>Use to enable the install of development catalog sources for pre-release installation.</p>
<ul>
<li>Environment Variable: <code>ARTIFACTORY_APIKEY</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="prometheus_retention_period">prometheus_retention_period<a class="headerlink" href="#prometheus_retention_period" title="Permanent link"></a></h3>
<p>Adjust the retention period for Prometheus metrics, only used when both <code>prometheus_storage_class</code> and <code>prometheus_alertmgr_storage_class</code> are set.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_RETENTION_PERIOD</code></li>
<li>Default Value: <code>15d</code></li>
</ul>
<h3 id="prometheus_storage_class">prometheus_storage_class<a class="headerlink" href="#prometheus_storage_class" title="Permanent link"></a></h3>
<p>Declare the storage class for Prometheus' metrics data persistent volume.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_STORAGE_CLASS</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="prometheus_storage_size">prometheus_storage_size<a class="headerlink" href="#prometheus_storage_size" title="Permanent link"></a></h3>
<p>Adjust the size of the volume used to store metrics, only used when both <code>prometheus_storage_class</code> and <code>prometheus_alertmgr_storage_class</code> are set.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_STORAGE_SIZE</code></li>
<li>Default Value: <code>300Gi</code></li>
</ul>
<h3 id="prometheus_alertmgr_storage_class">prometheus_alertmgr_storage_class<a class="headerlink" href="#prometheus_alertmgr_storage_class" title="Permanent link"></a></h3>
<p>Declare the storage class for AlertManager's persistent volume.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_ALERTMGR_STORAGE_CLASS</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="prometheus_alertmgr_storage_size">prometheus_alertmgr_storage_size<a class="headerlink" href="#prometheus_alertmgr_storage_size" title="Permanent link"></a></h3>
<p>Adjust the size of the volume used by AlertManager, only used when both <code>prometheus_storage_class</code> and <code>prometheus_alertmgr_storage_class</code> are set.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_ALERTMGR_STORAGE_SIZE</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h3 id="prometheus_userworkload_retention_period">prometheus_userworkload_retention_period<a class="headerlink" href="#prometheus_userworkload_retention_period" title="Permanent link"></a></h3>
<p>Adjust the retention period for User Workload Prometheus metrics, this parameter applies only to the User Workload Prometheus instance.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_USERWORKLOAD_RETENTION_PERIOD</code></li>
<li>Default Value: <code>15d</code></li>
</ul>
<h3 id="prometheus_userworkload_storage_class">prometheus_userworkload_storage_class<a class="headerlink" href="#prometheus_userworkload_storage_class" title="Permanent link"></a></h3>
<p>Declare the storage class for User Workload Prometheus' metrics data persistent volume.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_USERWORKLOAD_STORAGE_CLASS</code></li>
<li>Default Value: <code>PROMETHEUS_STORAGE_CLASS</code></li>
</ul>
<h3 id="prometheus_userworkload_storage_size">prometheus_userworkload_storage_size<a class="headerlink" href="#prometheus_userworkload_storage_size" title="Permanent link"></a></h3>
<p>Adjust the size of the volume used to store User Workload metrics.</p>
<ul>
<li>Environment Variable: <code>PROMETHEUS_USERWORKLOAD_STORAGE_SIZE</code></li>
<li>Default Value: <code>300Gi</code></li>
</ul>
<h3 id="mas_channel">mas_channel<a class="headerlink" href="#mas_channel" title="Permanent link"></a></h3>
<p>Used to determine whether to install SBO stable channel and the IBM badged cert-manager.</p>
<ul>
<li>Environment Variable: <code>MAS_CHANNEL</code></li>
<li>Default Value: <code>8.x</code></li>
</ul>
<h2 id="example-playbook">Example Playbook<a class="headerlink" href="#example-playbook" title="Permanent link"></a></h2>
<pre><code class="language-yaml">- hosts: localhost
  vars:
    cluster_type: roks
    prometheus_storage_class: &quot;ibmc-block-gold&quot;
    prometheus_alertmgr_storage_class: &quot;ibmc-file-gold-gid&quot;
  roles:
    - ibm.mas_devops.ocp_setup_mas_deps
</code></pre>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link"></a></h2>
<p>EPL-2.0</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/ansible-devops/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../ocp_setup_github_oauth/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ocp_setup_ocs/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
